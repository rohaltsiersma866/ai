<div class="message-card">
  <div class="message-header">
    <div>
      <h5 class="mb-1">{{ msg.subject }}</h5>
      <small class="text-muted">
        ğŸ‘¤ {{ msg.user_email }} â€¢ 
        ğŸ• {{ msg.created_at[:19] if msg.created_at else '' }}
      </small>
    </div>
    <div>
      {% if msg.status == 'pending' %}
        <span class="badge bg-warning">â³ Chá» xá»­ lÃ½</span>
      {% elif msg.status == 'replied' %}
        <span class="badge bg-success">âœ… ÄÃ£ tráº£ lá»i</span>
      {% else %}
        <span class="badge bg-secondary">{{ msg.status }}</span>
      {% endif %}
    </div>
  </div>

  <div class="message-body">
    <strong>ğŸ’¬ Ná»™i dung:</strong>
    <p class="mt-2">{{ msg.message }}</p>
  </div>

  {% if msg.status == 'replied' and msg.admin_reply %}
    <div class="admin-reply-box">
      <strong>âœ… Pháº£n há»“i cá»§a báº¡n:</strong>
      <p class="mt-2 mb-0">{{ msg.admin_reply }}</p>
      {% if msg.replied_at %}
        <small class="text-muted">Tráº£ lá»i lÃºc: {{ msg.replied_at[:19] }}</small>
      {% endif %}
    </div>
  {% else %}
    <div class="mt-3">
      <button class="btn btn-primary" onclick="toggleReplyForm({{ msg.id }})">
        ğŸ’¬ Tráº£ lá»i
      </button>
    </div>

    <div class="reply-form" id="reply-form-{{ msg.id }}" style="display: none;">
      <label class="form-label fw-bold">ğŸ“ Pháº£n há»“i cho user:</label>
      <textarea class="form-control mb-2" id="reply-text-{{ msg.id }}" rows="4" 
                placeholder="Nháº­p ná»™i dung tráº£ lá»i..."></textarea>
      <div class="d-flex gap-2">
        <button class="btn btn-success" onclick="submitReply({{ msg.id }})">
          ğŸ“¤ Gá»­i pháº£n há»“i
        </button>
        <button class="btn btn-outline-secondary" onclick="toggleReplyForm({{ msg.id }})">
          Há»§y
        </button>
      </div>
    </div>
  {% endif %}
</div>